<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="generator" content="mkdocs-1.6.1, mkdocs-terminal-4.7.0">
    
    <meta name="description" content="Documentation for the Floxide framework - A type-safe, composable directed graph workflow system written in Rust"> 
    
    <meta name="author" content="Floxide Team"> 
    <link rel="icon" type="image/png" sizes="192x192" href="../../img/android-chrome-192x192.png" />
<link rel="icon" type="image/png" sizes="512x512" href="../../img/android-chrome-512x512.png" />
<link rel="apple-touch-icon" sizes="180x180" href="../../img/apple-touch-icon.png" />
<link rel="shortcut icon" type="image/png" sizes="48x48" href="../../img/favicon.ico" />
<link rel="icon" type="image/png" sizes="16x16" href="../../img/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="../../img/favicon-32x32.png" />


    
 
<title>ADR-0013: Workflow Patterns - Floxide Documentation</title>


<link href="../../css/fontawesome/css/fontawesome.min.css" rel="stylesheet">
<link href="../../css/fontawesome/css/solid.min.css" rel="stylesheet">
<link href="../../css/normalize.css" rel="stylesheet">
<link href="../../css/terminal.css" rel="stylesheet">
<link href="../../css/theme.css" rel="stylesheet">
<link href="../../css/theme.tile_grid.css" rel="stylesheet">
<link href="../../css/theme.footer.css" rel="stylesheet">
<!-- dark color palette -->
<link href="../../css/palettes/dark.css" rel="stylesheet">

<!-- page layout -->
<style>
/* initially set page layout to a one column grid */
.terminal-mkdocs-main-grid {
    display: grid;
    grid-column-gap: 1.4em;
    grid-template-columns: auto;
    grid-template-rows: auto;
}

/*  
*   when side navigation is not hidden, use a two column grid.  
*   if the screen is too narrow, fall back to the initial one column grid layout.
*   in this case the main content will be placed under the navigation panel. 
*/
@media only screen and (min-width: 70em) {
    .terminal-mkdocs-main-grid {
        grid-template-columns: 4fr 9fr;
    }
}</style>



    
    <link href="../../css/extra.css" rel="stylesheet">  
    
    

    
    <!-- search css support -->
<link href="../../css/search/bootstrap-modal.css" rel="stylesheet">
<!-- search scripts -->
<script>
    var base_url = "../..",
    shortcuts = "{}";
</script>
<script src="../../js/jquery/jquery-1.10.1.min.js" defer></script>
<script src="../../js/bootstrap/bootstrap.min.js" defer></script>
<script src="../../js/mkdocs/base.js" defer></script>
    
    
    
    
    <script src="https://unpkg.com/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <script src="../../search/main.js"></script>
    

    
</head>

<body class="terminal"><div class="container">
    <div class="terminal-nav">
        <header class="terminal-logo">
            <div id="mkdocs-terminal-site-name" class="logo terminal-prompt"><a href="/" class="no-style">Floxide Documentation</a></div>
        </header>
        
        <nav class="terminal-menu">
            
            <ul vocab="https://schema.org/" typeof="BreadcrumbList">
                
                
                <li property="itemListElement" typeof="ListItem">
                    <a href="../.." class="menu-item " property="item" typeof="WebPage">
                        <span property="name">Home</span>
                    </a>
                    <meta property="position" content="0">
                </li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li property="itemListElement" typeof="ListItem">
                    <a href="../../contributing/" class="menu-item " property="item" typeof="WebPage">
                        <span property="name">Contributing</span>
                    </a>
                    <meta property="position" content="1">
                </li>
                
                    
                    


<li property="itemListElement" typeof="ListItem">
    <a href="#" class="menu-item" data-toggle="modal" data-target="#mkdocs_search_modal" property="item" typeof="SearchAction">
        <i aria-hidden="true" class="fa fa-search"></i> <span property="name">Search</span>
    </a>
    <meta property="position" content="2">
</li>
                    
            </ul>
            
        </nav>
    </div>
</div>
        
    <div class="container">
        <div class="terminal-mkdocs-main-grid"><aside id="terminal-mkdocs-side-panel"><nav>
  
    <ul class="terminal-mkdocs-side-nav-items">
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../..">Home</a>
        
    
    
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        
            
            
            <span class="
        
    

    terminal-mkdocs-side-nav-item terminal-mkdocs-side-nav-section-no-index">Getting Started</span>
        
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../getting-started/installation/">Installation</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../getting-started/quick-start/">Quick Start</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../getting-started/error-handling/">Error Handling</a>
        
    
    </li>
            
            
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        
            
            
            <span class="
        
    

    terminal-mkdocs-side-nav-item terminal-mkdocs-side-nav-section-no-index">Core Concepts</span>
        
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../core-concepts/overview/">Overview</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../core-concepts/nodes/">Nodes</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../core-concepts/workflows/">Workflows</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../core-concepts/actions/">Actions</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../core-concepts/contexts/">Contexts</a>
        
    
    </li>
            
            
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        
            
            
            <span class="
        
    

    terminal-mkdocs-side-nav-item terminal-mkdocs-side-nav-section-no-index">Guides</span>
        
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../guides/event_driven_architecture/">Event-Driven Architecture</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../guides/using-mermaid-diagrams/">Using Mermaid Diagrams</a>
        
    
    </li>
            
            
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        
            
            
            <span class="
        
    

    terminal-mkdocs-side-nav-item terminal-mkdocs-side-nav-section-no-index">Examples</span>
        
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../examples/basic-workflow/">Basic Workflow</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../examples/event-driven-workflow/">Event-Driven Workflow</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../examples/timer-node/">Timer Node</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../examples/reactive-node/">Reactive Node</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../examples/transform-node/">Transform Node</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../examples/longrunning-node/">Long-Running Node</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../examples/batch-processing/">Batch Processing</a>
        
    
    </li>
            
            
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        
            
            
            <span class="
        
    

    terminal-mkdocs-side-nav-item terminal-mkdocs-side-nav-section-no-index">Architecture</span>
        
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/adr-process/">ADR Process</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/core-framework-abstractions/">Core Framework Abstractions</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/project-structure/">Project Structure</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/async-runtime-selection/">Async Runtime Selection</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/node-lifecycle-methods/">Node Lifecycle Methods</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/event-driven-workflow-pattern/">Event-Driven Workflow Pattern</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/reactive-node-implementation/">Reactive Node Implementation</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/timer-node-implementation/">Timer Node Implementation</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/longrunning-node-implementation/">Long-Running Node Implementation</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/transform-node-implementation/">Transform Node Implementation</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/batch-processing-implementation/">Batch Processing Implementation</a>
        
    
    </li>
            
            
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        
            
            
            <span class="
        
    

    terminal-mkdocs-side-nav-item terminal-mkdocs-side-nav-section-no-index">API Reference</span>
        
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../api/floxide-core/">floxide-core</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../api/floxide-transform/">floxide-transform</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../api/floxide-event/">floxide-event</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../api/floxide-timer/">floxide-timer</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../api/floxide-reactive/">floxide-reactive</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../api/floxide-longrunning/">floxide-longrunning</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../api/floxide-batch/">floxide-batch</a>
        
    
    </li>
            
            
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../contributing/">Contributing</a>
        
    
    
    
  </li>
        
    </ul>
  
</nav><hr>
<nav>
    <ul>
        <li><a href="#adr-0013-workflow-patterns">ADR-0013: Workflow Patterns</a></li>
        <li><a href="#status">Status</a></li><li><a href="#date">Date</a></li><li><a href="#context">Context</a></li><li><a href="#decision">Decision</a></li><li><a href="#pattern-composition">Pattern Composition</a></li><li><a href="#visual-workflow-representation">Visual Workflow Representation</a></li><li><a href="#paradigm-patterns">Paradigm Patterns</a></li><li><a href="#consequences">Consequences</a></li><li><a href="#alternatives-considered">Alternatives Considered</a></li><li><a href="#references">References</a></li>
    </ul>
</nav>
</aside>
            <main id="terminal-mkdocs-main-content">
<section id="mkdocs-terminal-content">
    <h1 id="adr-0013-workflow-patterns">ADR-0013: Workflow Patterns<a class="headerlink" href="#adr-0013-workflow-patterns" title="Permanent link">&para;</a></h1>
<h2 id="status">Status<a class="headerlink" href="#status" title="Permanent link">&para;</a></h2>
<p>Accepted</p>
<h2 id="date">Date<a class="headerlink" href="#date" title="Permanent link">&para;</a></h2>
<p>2025-02-27</p>
<h2 id="context">Context<a class="headerlink" href="#context" title="Permanent link">&para;</a></h2>
<p>The Floxide framework is designed as a directed graph workflow system that can support various workflow patterns. To provide a comprehensive and flexible framework, we need to define and document the core workflow patterns that the framework will support. These patterns represent common use cases and architectural approaches for building workflows.</p>
<p>Users of the framework need clear guidance on how to implement different types of workflows to solve various business problems. By defining these patterns explicitly, we can ensure the framework's design accommodates all these use cases and provides appropriate abstractions.</p>
<h2 id="decision">Decision<a class="headerlink" href="#decision" title="Permanent link">&para;</a></h2>
<p>We will support eight core workflow patterns in the Floxide framework, each addressing different workflow requirements:</p>
<h3 id="1-node">1. Node<a class="headerlink" href="#1-node" title="Permanent link">&para;</a></h3>
<p><strong>Description</strong>: A single step operation that processes input and produces output.</p>
<p><strong>Implementation</strong>: This is the most basic building block, implemented through the <code>Node</code> trait.</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-0-1"><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Node</span><span class="o">&lt;</span><span class="n">Context</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">:</span><span class="w"> </span><span class="nc">ActionType</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-2"><span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">Output</span><span class="p">;</span>
</span><span id="__span-0-3">
</span><span id="__span-0-4"><span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Context</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">NodeOutcome</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">::</span><span class="n">Output</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">FloxideError</span><span class="o">&gt;</span><span class="p">;</span>
</span><span id="__span-0-5"><span class="p">}</span>
</span></code></pre></div>
<p><strong>Example Use Case</strong>: A node that summarizes an email as a standalone operation.</p>
<h3 id="2-chain">2. Chain<a class="headerlink" href="#2-chain" title="Permanent link">&para;</a></h3>
<p><strong>Description</strong>: A sequence of connected nodes where the output of one node becomes the input to the next.</p>
<p><strong>Implementation</strong>: Implemented through the <code>chain</code> combinator function that connects nodes sequentially.</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-1-1"><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">chain</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">N1</span><span class="p">,</span><span class="w"> </span><span class="n">N2</span><span class="o">&gt;</span><span class="p">(</span><span class="n">first</span><span class="p">:</span><span class="w"> </span><span class="nc">N1</span><span class="p">,</span><span class="w"> </span><span class="n">second</span><span class="p">:</span><span class="w"> </span><span class="nc">N2</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">impl</span><span class="w"> </span><span class="n">Node</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span>
</span><span id="__span-1-2"><span class="k">where</span>
</span><span id="__span-1-3"><span class="w">    </span><span class="n">N1</span><span class="p">:</span><span class="w"> </span><span class="nc">Node</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">,</span>
</span><span id="__span-1-4"><span class="w">    </span><span class="n">N2</span><span class="p">:</span><span class="w"> </span><span class="nc">Node</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">,</span>
</span><span id="__span-1-5"><span class="w">    </span><span class="n">A</span><span class="p">:</span><span class="w"> </span><span class="nc">ActionType</span><span class="p">,</span>
</span><span id="__span-1-6"><span class="p">{</span>
</span><span id="__span-1-7"><span class="w">    </span><span class="c1">// Implementation details</span>
</span><span id="__span-1-8"><span class="p">}</span>
</span></code></pre></div>
<p><strong>Example Use Case</strong>: A workflow that first summarizes an email and then drafts a reply based on that summary.</p>
<h3 id="3-batch">3. Batch<a class="headerlink" href="#3-batch" title="Permanent link">&para;</a></h3>
<p><strong>Description</strong>: Repeats the same processing step across multiple inputs in parallel.</p>
<p><strong>Implementation</strong>: Implemented through the <code>BatchFlow</code> struct that processes multiple contexts with the same node.</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-2-1"><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">BatchFlow</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-2"><span class="w">    </span><span class="n">node</span><span class="p">:</span><span class="w"> </span><span class="nc">N</span><span class="p">,</span>
</span><span id="__span-2-3"><span class="w">    </span><span class="n">_phantom</span><span class="p">:</span><span class="w"> </span><span class="nc">PhantomData</span><span class="o">&lt;</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
</span><span id="__span-2-4"><span class="p">}</span>
</span><span id="__span-2-5">
</span><span id="__span-2-6"><span class="k">impl</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="n">BatchFlow</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span>
</span><span id="__span-2-7"><span class="k">where</span>
</span><span id="__span-2-8"><span class="w">    </span><span class="n">N</span><span class="p">:</span><span class="w"> </span><span class="nc">Node</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Clone</span><span class="p">,</span>
</span><span id="__span-2-9"><span class="w">    </span><span class="n">C</span><span class="p">:</span><span class="w"> </span><span class="nb">Clone</span><span class="p">,</span>
</span><span id="__span-2-10"><span class="w">    </span><span class="n">A</span><span class="p">:</span><span class="w"> </span><span class="nc">ActionType</span><span class="p">,</span>
</span><span id="__span-2-11"><span class="p">{</span>
</span><span id="__span-2-12"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">new</span><span class="p">(</span><span class="n">node</span><span class="p">:</span><span class="w"> </span><span class="nc">N</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-13"><span class="w">        </span><span class="c1">// Implementation details</span>
</span><span id="__span-2-14"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-2-15">
</span><span id="__span-2-16"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">execute_all</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">contexts</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">[</span><span class="n">C</span><span class="p">])</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">N</span><span class="p">::</span><span class="n">Output</span><span class="p">,</span><span class="w"> </span><span class="n">FloxideError</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-17"><span class="w">        </span><span class="c1">// Implementation details</span>
</span><span id="__span-2-18"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-2-19"><span class="p">}</span>
</span></code></pre></div>
<p><strong>Example Use Case</strong>: Summarizing multiple emails simultaneously, improving throughput for repetitive tasks.</p>
<h3 id="4-async">4. Async<a class="headerlink" href="#4-async" title="Permanent link">&para;</a></h3>
<p><strong>Description</strong>: Handles operations that involve waiting for I/O or external events.</p>
<p><strong>Implementation</strong>: Leverages Rust's async/await syntax and the Tokio runtime for asynchronous execution.</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-3-1"><span class="k">pub</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">execute</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">C</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">::</span><span class="n">Output</span><span class="p">,</span><span class="w"> </span><span class="n">FloxideError</span><span class="o">&gt;</span>
</span><span id="__span-3-2"><span class="k">where</span>
</span><span id="__span-3-3"><span class="w">    </span><span class="n">A</span><span class="p">:</span><span class="w"> </span><span class="nc">ActionType</span><span class="p">,</span>
</span><span id="__span-3-4"><span class="p">{</span>
</span><span id="__span-3-5"><span class="w">    </span><span class="c1">// Implementation details with async/await</span>
</span><span id="__span-3-6"><span class="p">}</span>
</span></code></pre></div>
<p><strong>Example Use Case</strong>: Checking an inbox (which involves I/O wait) and then processing new emails when they arrive.</p>
<h3 id="5-shared">5. Shared<a class="headerlink" href="#5-shared" title="Permanent link">&para;</a></h3>
<p><strong>Description</strong>: Enables communication between nodes through shared state.</p>
<p><strong>Implementation</strong>: Uses shared references or Arc<Mutex\<T>> for state that needs to be accessed by multiple nodes.</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-4-1"><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">SharedState</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-2"><span class="w">    </span><span class="n">inner</span><span class="p">:</span><span class="w"> </span><span class="nc">Arc</span><span class="o">&lt;</span><span class="n">Mutex</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span id="__span-4-3"><span class="p">}</span>
</span><span id="__span-4-4">
</span><span id="__span-4-5"><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">SharedState</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-6"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">new</span><span class="p">(</span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-7"><span class="w">        </span><span class="c1">// Implementation details</span>
</span><span id="__span-4-8"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-4-9">
</span><span id="__span-4-10"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">read</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="nc">F</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">R</span>
</span><span id="__span-4-11"><span class="w">    </span><span class="k">where</span>
</span><span id="__span-4-12"><span class="w">        </span><span class="n">F</span><span class="p">:</span><span class="w"> </span><span class="nb">FnOnce</span><span class="p">(</span><span class="o">&amp;</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">R</span><span class="p">,</span>
</span><span id="__span-4-13"><span class="w">    </span><span class="p">{</span>
</span><span id="__span-4-14"><span class="w">        </span><span class="c1">// Implementation details</span>
</span><span id="__span-4-15"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-4-16">
</span><span id="__span-4-17"><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">write</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="nc">F</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">R</span>
</span><span id="__span-4-18"><span class="w">    </span><span class="k">where</span>
</span><span id="__span-4-19"><span class="w">        </span><span class="n">F</span><span class="p">:</span><span class="w"> </span><span class="nb">FnOnce</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">R</span><span class="p">,</span>
</span><span id="__span-4-20"><span class="w">    </span><span class="p">{</span>
</span><span id="__span-4-21"><span class="w">        </span><span class="c1">// Implementation details</span>
</span><span id="__span-4-22"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-4-23"><span class="p">}</span>
</span></code></pre></div>
<p><strong>Example Use Case</strong>: The "Summarize Email" node writes an email summary to a shared state, and the "Draft Reply" node reads from that shared state rather than receiving direct input from the previous node.</p>
<h3 id="6-branch">6. Branch<a class="headerlink" href="#6-branch" title="Permanent link">&para;</a></h3>
<p><strong>Description</strong>: Implements conditional logic to determine the next step based on certain criteria.</p>
<p><strong>Implementation</strong>: Uses the <code>ActionType</code> enum to determine which branch to take based on the node outcome.</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-5-1"><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">branch</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">N1</span><span class="p">,</span><span class="w"> </span><span class="n">N2</span><span class="p">,</span><span class="w"> </span><span class="n">N3</span><span class="o">&gt;</span><span class="p">(</span>
</span><span id="__span-5-2"><span class="w">    </span><span class="n">condition_node</span><span class="p">:</span><span class="w"> </span><span class="nc">N1</span><span class="p">,</span>
</span><span id="__span-5-3"><span class="w">    </span><span class="n">true_branch</span><span class="p">:</span><span class="w"> </span><span class="nc">N2</span><span class="p">,</span>
</span><span id="__span-5-4"><span class="w">    </span><span class="n">false_branch</span><span class="p">:</span><span class="w"> </span><span class="nc">N3</span><span class="p">,</span>
</span><span id="__span-5-5"><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">impl</span><span class="w"> </span><span class="n">Node</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span>
</span><span id="__span-5-6"><span class="k">where</span>
</span><span id="__span-5-7"><span class="w">    </span><span class="n">N1</span><span class="p">:</span><span class="w"> </span><span class="nc">Node</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">,</span>
</span><span id="__span-5-8"><span class="w">    </span><span class="n">N2</span><span class="p">:</span><span class="w"> </span><span class="nc">Node</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">,</span>
</span><span id="__span-5-9"><span class="w">    </span><span class="n">N3</span><span class="p">:</span><span class="w"> </span><span class="nc">Node</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">,</span>
</span><span id="__span-5-10"><span class="w">    </span><span class="n">A</span><span class="p">:</span><span class="w"> </span><span class="nc">ActionType</span><span class="p">,</span>
</span><span id="__span-5-11"><span class="p">{</span>
</span><span id="__span-5-12"><span class="w">    </span><span class="c1">// Implementation details</span>
</span><span id="__span-5-13"><span class="p">}</span>
</span></code></pre></div>
<p><strong>Example Use Case</strong>: After summarizing an email, we determine if it needs review. If it does, it goes to the "Review" node and then to "Draft Reply" after approval. If review is not needed, it goes directly to "Draft Reply".</p>
<h3 id="7-nesting">7. Nesting<a class="headerlink" href="#7-nesting" title="Permanent link">&para;</a></h3>
<p><strong>Description</strong>: Allows workflows to be composed of other workflows, creating reusable components.</p>
<p><strong>Implementation</strong>: Workflows can be nested by creating a node that contains another workflow.</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-6-1"><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">NestedWorkflow</span><span class="o">&lt;</span><span class="n">W</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-2"><span class="w">    </span><span class="n">workflow</span><span class="p">:</span><span class="w"> </span><span class="nc">W</span><span class="p">,</span>
</span><span id="__span-6-3"><span class="w">    </span><span class="n">_phantom</span><span class="p">:</span><span class="w"> </span><span class="nc">PhantomData</span><span class="o">&lt;</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
</span><span id="__span-6-4"><span class="p">}</span>
</span><span id="__span-6-5">
</span><span id="__span-6-6"><span class="k">impl</span><span class="o">&lt;</span><span class="n">W</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Node</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">NestedWorkflow</span><span class="o">&lt;</span><span class="n">W</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span>
</span><span id="__span-6-7"><span class="k">where</span>
</span><span id="__span-6-8"><span class="w">    </span><span class="n">W</span><span class="p">:</span><span class="w"> </span><span class="nc">Workflow</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">,</span>
</span><span id="__span-6-9"><span class="w">    </span><span class="n">A</span><span class="p">:</span><span class="w"> </span><span class="nc">ActionType</span><span class="p">,</span>
</span><span id="__span-6-10"><span class="p">{</span>
</span><span id="__span-6-11"><span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">W</span><span class="p">::</span><span class="n">Output</span><span class="p">;</span>
</span><span id="__span-6-12">
</span><span id="__span-6-13"><span class="w">    </span><span class="k">async</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">C</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">NodeOutcome</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">::</span><span class="n">Output</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">FloxideError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-14"><span class="w">        </span><span class="c1">// Implementation details</span>
</span><span id="__span-6-15"><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-16"><span class="p">}</span>
</span></code></pre></div>
<p><strong>Example Use Case</strong>: A "Coding Task" node that triggers a nested workflow for software development. This nested workflow includes writing tests, writing code, verifying code, and analyzing complexity.</p>
<h3 id="8-looping">8. Looping<a class="headerlink" href="#8-looping" title="Permanent link">&para;</a></h3>
<p><strong>Description</strong>: Implements repetitive processes that continue until a condition is met.</p>
<p><strong>Implementation</strong>: Uses recursion or a loop combinator to repeat a node until a condition is met.</p>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-7-1"><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">loop_until</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span>
</span><span id="__span-7-2"><span class="w">    </span><span class="n">node</span><span class="p">:</span><span class="w"> </span><span class="nc">N</span><span class="p">,</span>
</span><span id="__span-7-3"><span class="w">    </span><span class="n">condition</span><span class="p">:</span><span class="w"> </span><span class="nc">F</span><span class="p">,</span>
</span><span id="__span-7-4"><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">impl</span><span class="w"> </span><span class="n">Node</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span>
</span><span id="__span-7-5"><span class="k">where</span>
</span><span id="__span-7-6"><span class="w">    </span><span class="n">N</span><span class="p">:</span><span class="w"> </span><span class="nc">Node</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Clone</span><span class="p">,</span>
</span><span id="__span-7-7"><span class="w">    </span><span class="n">F</span><span class="p">:</span><span class="w"> </span><span class="nb">Fn</span><span class="p">(</span><span class="o">&amp;</span><span class="n">N</span><span class="p">::</span><span class="n">Output</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Send</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Sync</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">&#39;</span><span class="nb">static</span><span class="p">,</span>
</span><span id="__span-7-8"><span class="w">    </span><span class="n">A</span><span class="p">:</span><span class="w"> </span><span class="nc">ActionType</span><span class="p">,</span>
</span><span id="__span-7-9"><span class="p">{</span>
</span><span id="__span-7-10"><span class="w">    </span><span class="c1">// Implementation details</span>
</span><span id="__span-7-11"><span class="p">}</span>
</span></code></pre></div>
<p><strong>Example Use Case</strong>: A long-running workflow that starts with "Get Question", proceeds to "Answer Question", and then loops back to "Get Question" to continue the cycle indefinitely.</p>
<h2 id="pattern-composition">Pattern Composition<a class="headerlink" href="#pattern-composition" title="Permanent link">&para;</a></h2>
<p>A key architectural decision is to support the composition of these patterns to create more complex workflows. The framework is designed to allow these patterns to be combined in various ways:</p>
<h3 id="composition-strategies">Composition Strategies<a class="headerlink" href="#composition-strategies" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Hierarchical Composition</strong>: Patterns can be nested within each other, such as a Branch pattern within a Loop, or a Chain within a Nested workflow.</p>
</li>
<li>
<p><strong>Sequential Composition</strong>: Patterns can be chained together, with the output of one pattern becoming the input to another.</p>
</li>
<li>
<p><strong>Parallel Composition</strong>: Multiple patterns can be executed in parallel using the Batch pattern.</p>
</li>
<li>
<p><strong>State-Sharing Composition</strong>: Different patterns can communicate through shared state.</p>
</li>
</ol>
<h3 id="common-composition-patterns">Common Composition Patterns<a class="headerlink" href="#common-composition-patterns" title="Permanent link">&para;</a></h3>
<p>Based on real-world use cases, we've identified several common composition patterns:</p>
<ol>
<li><strong>Chain + Branch</strong>: Create sequential workflows with decision points</li>
</ol>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-8-1"><span class="kd">let</span><span class="w"> </span><span class="n">workflow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chain</span><span class="p">(</span>
</span><span id="__span-8-2"><span class="w">    </span><span class="n">summarize_email_node</span><span class="p">,</span>
</span><span id="__span-8-3"><span class="w">    </span><span class="n">branch</span><span class="p">(</span>
</span><span id="__span-8-4"><span class="w">        </span><span class="n">needs_review_node</span><span class="p">,</span>
</span><span id="__span-8-5"><span class="w">        </span><span class="n">review_node</span><span class="p">,</span>
</span><span id="__span-8-6"><span class="w">        </span><span class="n">draft_reply_node</span>
</span><span id="__span-8-7"><span class="w">    </span><span class="p">)</span>
</span><span id="__span-8-8"><span class="p">);</span>
</span></code></pre></div>
<ol>
<li><strong>Batch + Async</strong>: Process multiple items in parallel while handling I/O operations</li>
</ol>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-9-1"><span class="kd">let</span><span class="w"> </span><span class="n">batch_workflow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BatchFlow</span><span class="p">::</span><span class="n">new</span><span class="p">(</span>
</span><span id="__span-9-2"><span class="w">    </span><span class="n">async_node</span><span class="p">(</span><span class="n">check_inbox_and_process</span><span class="p">)</span>
</span><span id="__span-9-3"><span class="p">);</span>
</span></code></pre></div>
<ol>
<li><strong>Nesting + Shared</strong>: Build reusable workflow components that communicate through shared state</li>
</ol>
<div class="language-rust highlight"><pre><span></span><code><span id="__span-10-1"><span class="kd">let</span><span class="w"> </span><span class="n">shared_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SharedState</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">EmailSummary</span><span class="p">::</span><span class="n">default</span><span class="p">());</span>
</span><span id="__span-10-2">
</span><span id="__span-10-3"><span class="kd">let</span><span class="w"> </span><span class="n">nested_workflow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NestedWorkflow</span><span class="p">::</span><span class="n">new</span><span class="p">(</span>
</span><span id="__span-10-4"><span class="w">    </span><span class="n">chain</span><span class="p">(</span>
</span><span id="__span-10-5"><span class="w">        </span><span class="n">write_to_shared_state</span><span class="p">(</span><span class="n">shared_state</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"> </span><span class="n">summarize_email_node</span><span class="p">),</span>
</span><span id="__span-10-6"><span class="w">        </span><span class="n">read_from_shared_state</span><span class="p">(</span><span class="n">shared_state</span><span class="p">,</span><span class="w"> </span><span class="n">draft_reply_node</span><span class="p">)</span>
</span><span id="__span-10-7"><span class="w">    </span><span class="p">)</span>
</span><span id="__span-10-8"><span class="p">);</span>
</span></code></pre></div>
<ol>
<li><strong>Looping + Branch</strong>: Implement iterative processes with exit conditions
   <div class="language-rust highlight"><pre><span></span><code><span id="__span-11-1"><span class="kd">let</span><span class="w"> </span><span class="n">workflow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loop_until</span><span class="p">(</span>
</span><span id="__span-11-2"><span class="w">    </span><span class="n">chain</span><span class="p">(</span>
</span><span id="__span-11-3"><span class="w">        </span><span class="n">get_question_node</span><span class="p">,</span>
</span><span id="__span-11-4"><span class="w">        </span><span class="n">answer_question_node</span><span class="p">,</span>
</span><span id="__span-11-5"><span class="w">        </span><span class="n">branch</span><span class="p">(</span>
</span><span id="__span-11-6"><span class="w">            </span><span class="n">is_final_question_node</span><span class="p">,</span>
</span><span id="__span-11-7"><span class="w">            </span><span class="n">complete_node</span><span class="p">,</span>
</span><span id="__span-11-8"><span class="w">            </span><span class="n">continue_node</span>
</span><span id="__span-11-9"><span class="w">        </span><span class="p">)</span>
</span><span id="__span-11-10"><span class="w">    </span><span class="p">),</span>
</span><span id="__span-11-11"><span class="w">    </span><span class="o">|</span><span class="n">outcome</span><span class="o">|</span><span class="w"> </span><span class="n">outcome</span><span class="p">.</span><span class="n">is_complete</span><span class="p">()</span>
</span><span id="__span-11-12"><span class="p">);</span>
</span></code></pre></div></li>
</ol>
<h3 id="implementation-considerations">Implementation Considerations<a class="headerlink" href="#implementation-considerations" title="Permanent link">&para;</a></h3>
<p>When implementing pattern composition, we need to ensure:</p>
<ol>
<li><strong>Type Safety</strong>: Composed patterns should maintain Rust's strong type safety.</li>
<li><strong>Error Propagation</strong>: Errors should propagate correctly through composed patterns.</li>
<li><strong>Performance</strong>: Composition should not introduce significant overhead.</li>
<li><strong>Readability</strong>: The API for composing patterns should be intuitive and readable.</li>
</ol>
<h2 id="visual-workflow-representation">Visual Workflow Representation<a class="headerlink" href="#visual-workflow-representation" title="Permanent link">&para;</a></h2>
<p>An important aspect of workflow design is the ability to visualize workflows. We've decided to adopt a standardized visual representation for each pattern to help users design and communicate their workflow architectures:</p>
<h3 id="visual-pattern-language">Visual Pattern Language<a class="headerlink" href="#visual-pattern-language" title="Permanent link">&para;</a></h3>
<p>Each pattern has a distinct visual representation:</p>
<ol>
<li>
<p><strong>Node</strong>: Single rectangle labeled with the operation (e.g., "Summarize Email") and noted as "Single step"</p>
</li>
<li>
<p><strong>Chain</strong>: Connected rectangles with directional arrows (e.g., "Summarize Email" → "Draft Reply") and noted as "Multiple steps"</p>
</li>
<li>
<p><strong>Batch</strong>: Multiple stacked rectangles representing parallel instances of the same node (e.g., stacked "Summarize Email" boxes) and noted as "Repeat steps"</p>
</li>
<li>
<p><strong>Async</strong>: Rectangle with a clock icon indicating waiting for events (e.g., "Check Inbox" with clock) and noted as "I/O wait"</p>
</li>
<li>
<p><strong>Shared</strong>: Connected nodes with a dashed rectangle for shared state and dotted arrows indicating read/write operations (e.g., "Email summary" state between nodes with write/read arrows) and noted as "Communication"</p>
</li>
<li>
<p><strong>Branch</strong>: Node with multiple outgoing paths based on conditions (e.g., "Need review" vs. direct paths) and noted as "Conditional step"</p>
</li>
<li>
<p><strong>Nesting</strong>: Node that expands to reveal a contained workflow within a dashed border (e.g., "Coding Task" expanding to reveal test/code/verify/analyze steps) and noted as "Reusable step"</p>
</li>
<li>
<p><strong>Looping</strong>: Nodes with return arrows forming a cycle (e.g., "Get Question" → "Answer Question" with return arrow) and noted as "Long running step"</p>
</li>
</ol>
<p>For paradigm patterns, we use additional visual indicators:</p>
<ol>
<li>
<p><strong>Workflow</strong>: Simple directed path with sequential nodes, labeled "Directed Path"</p>
</li>
<li>
<p><strong>Map-Reduce</strong>: Batch + Merge pattern showing data chunking, parallel processing, and result aggregation</p>
</li>
<li>
<p><strong>Chat</strong>: Single node with self-loop and shared state for history, labeled "Loop (+ chat history store)"</p>
</li>
<li>
<p><strong>RAG</strong>: Nodes with vector database as shared state, labeled "(+ Vector DB store)"</p>
</li>
<li>
<p><strong>Chain of Thought</strong>: Single node with self-loop and history tracking, labeled "Loop (+ think history store)"</p>
</li>
<li>
<p><strong>Agent</strong>: Nodes with branching and feedback loops, labeled "Loop + Branching"</p>
</li>
<li>
<p><strong>Multi-Agent</strong>: Complex interconnected graph with shared pub/sub communication, labeled "Loop + Branching (+ pub/sub)"</p>
</li>
<li>
<p><strong>Supervisor</strong>: Nested workflow with approval/rejection paths, labeled "Nesting"</p>
</li>
</ol>
<h3 id="complex-workflow-example">Complex Workflow Example<a class="headerlink" href="#complex-workflow-example" title="Permanent link">&para;</a></h3>
<p>Here's an example of a complex email processing workflow that combines multiple patterns:</p>
<div class="mermaid">graph TD
    Start[Start] --&gt; CheckInbox["Check Inbox (Async)"]
    CheckInbox --&gt; HasEmails{Has New Emails?}
    HasEmails --&gt;|No| Wait["Wait (Async)"]
    Wait --&gt; CheckInbox
    HasEmails --&gt;|Yes| BatchProcess["Process Emails (Batch)"]

    subgraph "For Each Email"
        BatchProcess --&gt; Summarize["Summarize Email"]
        Summarize --&gt; NeedsReview{Needs Review?}
        NeedsReview --&gt;|Yes| Review["Review Email"]
        NeedsReview --&gt;|No| Draft["Draft Reply"]
        Review --&gt; Draft

        subgraph "Draft Reply Process (Nested)"
            Draft --&gt; GenerateTemplate["Generate Template"]
            GenerateTemplate --&gt; AddPersonalization["Add Personalization"]
            AddPersonalization --&gt; CheckGrammar["Check Grammar"]
        end

        CheckGrammar --&gt; SendReply["Send Reply"]
    end

    SendReply --&gt; UpdateStatus["Update Status (Shared State)"]
    UpdateStatus --&gt; CheckInbox</div>
<p>This visualization demonstrates how multiple patterns can be combined to create a comprehensive workflow solution.</p>
<h3 id="benefits-of-visual-representation">Benefits of Visual Representation<a class="headerlink" href="#benefits-of-visual-representation" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Communication</strong>: Facilitates discussion about workflow design among team members</li>
<li><strong>Documentation</strong>: Provides clear documentation of workflow architecture</li>
<li><strong>Design</strong>: Helps identify optimization opportunities and potential issues</li>
<li><strong>Onboarding</strong>: Makes it easier for new developers to understand existing workflows</li>
</ol>
<h3 id="implementation">Implementation<a class="headerlink" href="#implementation" title="Permanent link">&para;</a></h3>
<p>While the framework itself doesn't include visualization tools, we recommend using Mermaid or similar tools to create workflow diagrams following our visual pattern language. These diagrams can be included in documentation and design discussions.</p>
<h2 id="paradigm-patterns">Paradigm Patterns<a class="headerlink" href="#paradigm-patterns" title="Permanent link">&para;</a></h2>
<p>In addition to the core workflow patterns, we recognize that the framework will be used to implement specialized workflow types for AI and automation applications. These specialized workflows can be built by combining the core patterns in specific ways:</p>
<h3 id="1-standard-workflow">1. Standard Workflow<a class="headerlink" href="#1-standard-workflow" title="Permanent link">&para;</a></h3>
<p><strong>Description</strong>: Simple directed path workflow with sequential processing.</p>
<p><strong>Implementation</strong>: Primarily uses the Chain pattern for a direct processing path.</p>
<p><strong>Example Use Case</strong>: Email processing with "Summarize Email" followed by "Draft Reply".</p>
<h3 id="2-chat-workflow">2. Chat Workflow<a class="headerlink" href="#2-chat-workflow" title="Permanent link">&para;</a></h3>
<p><strong>Description</strong>: Looping conversation flow with state management for chat history.</p>
<p><strong>Implementation</strong>: Combines Looping pattern with Shared State to maintain conversation context.</p>
<p><strong>Example Use Case</strong>: Chat system with a single "Chat" node that loops back to itself, writing to and reading from a "chat history" shared store.</p>
<h3 id="3-rag-retrieval-augmented-generation">3. RAG (Retrieval Augmented Generation)<a class="headerlink" href="#3-rag-retrieval-augmented-generation" title="Permanent link">&para;</a></h3>
<p><strong>Description</strong>: Workflows that integrate document storage and retrieval for question answering.</p>
<p><strong>Implementation</strong>: Combines Shared State (for vector database) with processing nodes for upload and question answering.</p>
<p><strong>Example Use Case</strong>: A system with "Upload documents" node that writes to a "Vector DB" shared store, and an "Answer Questions" node that reads from it.</p>
<h3 id="4-chain-of-thought-cot">4. Chain of Thought (CoT)<a class="headerlink" href="#4-chain-of-thought-cot" title="Permanent link">&para;</a></h3>
<p><strong>Description</strong>: Single "thinking" step that loops and maintains reasoning history.</p>
<p><strong>Implementation</strong>: Combines Looping with Shared State to store thinking steps and intermediate reasoning.</p>
<p><strong>Example Use Case</strong>: Reasoning system with a single "Think" node that loops back to itself, writing to and reading from a "think history" shared store.</p>
<h3 id="5-map-reduce">5. Map Reduce<a class="headerlink" href="#5-map-reduce" title="Permanent link">&para;</a></h3>
<p><strong>Description</strong>: Batch processing of data chunks followed by aggregation of results.</p>
<p><strong>Implementation</strong>: Combines Batch (for mapping chunks) with a reduction node that aggregates results.</p>
<p><strong>Example Use Case</strong>: System that uses "Map Chunks" to distribute work to multiple "Summarize Chunk" operations in parallel, then aggregates results with "Reduce Summaries".</p>
<h3 id="6-agent">6. Agent<a class="headerlink" href="#6-agent" title="Permanent link">&para;</a></h3>
<p><strong>Description</strong>: Autonomous workflows with branching decision logic and feedback loops.</p>
<p><strong>Implementation</strong>: Combines Looping and Branch patterns to create a decision-action cycle.</p>
<p><strong>Example Use Case</strong>: Email processing agent that summarizes an email, branches to either "Review" or "Draft Reply" based on content, and continues processing.</p>
<h3 id="7-multi-agent">7. Multi-agent<a class="headerlink" href="#7-multi-agent" title="Permanent link">&para;</a></h3>
<p><strong>Description</strong>: Complex interconnected workflows with multiple processing nodes and publish/subscribe communication.</p>
<p><strong>Implementation</strong>: Uses multiple Node workflows with pub/sub shared state for coordination and communication.</p>
<p><strong>Example Use Case</strong>: Distributed system where multiple nodes communicate through a shared pub/sub message bus, creating a complex processing graph.</p>
<h3 id="8-supervisor">8. Supervisor<a class="headerlink" href="#8-supervisor" title="Permanent link">&para;</a></h3>
<p><strong>Description</strong>: Nested workflows with oversight that can approve or reject work.</p>
<p><strong>Implementation</strong>: Combines Nesting pattern with Branch for approval/rejection decisions.</p>
<p><strong>Example Use Case</strong>: Quality control system where a "Supervise" node reviews the output of a nested workflow and can either approve it to continue or reject it back for rework.</p>
<h2 id="consequences">Consequences<a class="headerlink" href="#consequences" title="Permanent link">&para;</a></h2>
<h3 id="positive">Positive<a class="headerlink" href="#positive" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Comprehensive Framework</strong>: By supporting these eight patterns, Floxide can address a wide range of workflow requirements.</li>
<li><strong>Clear Documentation</strong>: Explicitly defining these patterns provides clear guidance to users on how to implement different types of workflows.</li>
<li><strong>Consistent Design</strong>: Having these patterns defined upfront ensures the framework's design is consistent and accommodates all these use cases.</li>
<li><strong>Flexibility</strong>: The combination of these patterns allows for complex workflow designs that can solve real-world problems.</li>
</ol>
<h3 id="negative">Negative<a class="headerlink" href="#negative" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Implementation Complexity</strong>: Supporting all these patterns increases the complexity of the framework implementation.</li>
<li><strong>Learning Curve</strong>: Users need to understand multiple patterns to effectively use the framework.</li>
<li><strong>Maintenance Overhead</strong>: More patterns mean more code to maintain and test.</li>
</ol>
<h3 id="neutral">Neutral<a class="headerlink" href="#neutral" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Pattern Combinations</strong>: These patterns can be combined in various ways, which provides flexibility but also requires careful design.</li>
<li><strong>Performance Considerations</strong>: Different patterns may have different performance characteristics that users need to be aware of.</li>
</ol>
<h2 id="alternatives-considered">Alternatives Considered<a class="headerlink" href="#alternatives-considered" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Simplified Pattern Set</strong>: We considered supporting fewer patterns for simplicity, but decided that the comprehensive set provides more value to users.</li>
<li><strong>Different Implementation Approaches</strong>: For each pattern, we considered multiple implementation approaches before settling on the current design.</li>
<li><strong>External DSL</strong>: We considered creating an external DSL for workflow definition but decided that a code-based approach using Rust's type system provides better safety and flexibility.</li>
</ol>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="http://www.workflowpatterns.com/">Workflow Patterns Initiative</a></li>
<li><a href="https://www.enterpriseintegrationpatterns.com/">Enterprise Integration Patterns</a></li>
<li><a href="https://rust-lang.github.io/async-book/">Rust Async Book</a></li>
</ul>
</section>

            </main>
        </div>
        <hr><footer>
    <div class="terminal-mkdocs-footer-grid">
        <div id="terminal-mkdocs-footer-copyright-info">
             Site built with <a href="http://www.mkdocs.org">MkDocs</a> and <a href="https://github.com/ntno/mkdocs-terminal">Terminal for MkDocs</a>.
        </div>
    </div>
</footer>
    </div>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="alertdialog" aria-modal="true" aria-labelledby="searchModalLabel">
    <div class="modal-dialog modal-lg" role="search">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="searchModalLabel">Search</h5>
                <button type="button" class="close btn btn-default btn-ghost" data-dismiss="modal"><span aria-hidden="true">x</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p id="searchInputLabel">Type to start searching</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" aria-labelledby="searchInputLabel" placeholder="" id="mkdocs-search-query" title="Please enter search terms here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No document matches found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    
    
</body>

</html>