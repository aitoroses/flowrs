<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="generator" content="mkdocs-1.6.1, mkdocs-terminal-4.7.0">
    
    <meta name="description" content="Documentation for the Floxide framework - A type-safe, composable directed graph workflow system written in Rust"> 
    
    <meta name="author" content="Floxide Team"> 
    <link rel="icon" type="image/png" sizes="192x192" href="../../img/android-chrome-192x192.png" />
<link rel="icon" type="image/png" sizes="512x512" href="../../img/android-chrome-512x512.png" />
<link rel="apple-touch-icon" sizes="180x180" href="../../img/apple-touch-icon.png" />
<link rel="shortcut icon" type="image/png" sizes="48x48" href="../../img/favicon.ico" />
<link rel="icon" type="image/png" sizes="16x16" href="../../img/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="../../img/favicon-32x32.png" />


    
 
<title>ADR-0028: Version Bump Workflow Improvements - Floxide Documentation</title>


<link href="../../css/fontawesome/css/fontawesome.min.css" rel="stylesheet">
<link href="../../css/fontawesome/css/solid.min.css" rel="stylesheet">
<link href="../../css/normalize.css" rel="stylesheet">
<link href="../../css/terminal.css" rel="stylesheet">
<link href="../../css/theme.css" rel="stylesheet">
<link href="../../css/theme.tile_grid.css" rel="stylesheet">
<link href="../../css/theme.footer.css" rel="stylesheet">
<!-- dark color palette -->
<link href="../../css/palettes/dark.css" rel="stylesheet">

<!-- page layout -->
<style>
/* initially set page layout to a one column grid */
.terminal-mkdocs-main-grid {
    display: grid;
    grid-column-gap: 1.4em;
    grid-template-columns: auto;
    grid-template-rows: auto;
}

/*  
*   when side navigation is not hidden, use a two column grid.  
*   if the screen is too narrow, fall back to the initial one column grid layout.
*   in this case the main content will be placed under the navigation panel. 
*/
@media only screen and (min-width: 70em) {
    .terminal-mkdocs-main-grid {
        grid-template-columns: 4fr 9fr;
    }
}</style>



    
    <link href="../../css/extra.css" rel="stylesheet">  
    
    

    
    <!-- search css support -->
<link href="../../css/search/bootstrap-modal.css" rel="stylesheet">
<!-- search scripts -->
<script>
    var base_url = "../..",
    shortcuts = "{}";
</script>
<script src="../../js/jquery/jquery-1.10.1.min.js" defer></script>
<script src="../../js/bootstrap/bootstrap.min.js" defer></script>
<script src="../../js/mkdocs/base.js" defer></script>
    
    
    
    
    <script src="https://unpkg.com/mermaid@10.6.1/dist/mermaid.min.js"></script>
    
    <script src="../../search/main.js"></script>
    

    
</head>

<body class="terminal"><div class="container">
    <div class="terminal-nav">
        <header class="terminal-logo">
            <div id="mkdocs-terminal-site-name" class="logo terminal-prompt"><a href="/" class="no-style">Floxide Documentation</a></div>
        </header>
        
        <nav class="terminal-menu">
            
            <ul vocab="https://schema.org/" typeof="BreadcrumbList">
                
                
                <li property="itemListElement" typeof="ListItem">
                    <a href="../.." class="menu-item " property="item" typeof="WebPage">
                        <span property="name">Home</span>
                    </a>
                    <meta property="position" content="0">
                </li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <li property="itemListElement" typeof="ListItem">
                    <a href="../../contributing/" class="menu-item " property="item" typeof="WebPage">
                        <span property="name">Contributing</span>
                    </a>
                    <meta property="position" content="1">
                </li>
                
                    
                    


<li property="itemListElement" typeof="ListItem">
    <a href="#" class="menu-item" data-toggle="modal" data-target="#mkdocs_search_modal" property="item" typeof="SearchAction">
        <i aria-hidden="true" class="fa fa-search"></i> <span property="name">Search</span>
    </a>
    <meta property="position" content="2">
</li>
                    
            </ul>
            
        </nav>
    </div>
</div>
        
    <div class="container">
        <div class="terminal-mkdocs-main-grid"><aside id="terminal-mkdocs-side-panel"><nav>
  
    <ul class="terminal-mkdocs-side-nav-items">
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../..">Home</a>
        
    
    
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        
            
            
            <span class="
        
    

    terminal-mkdocs-side-nav-item terminal-mkdocs-side-nav-section-no-index">Getting Started</span>
        
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../getting-started/installation/">Installation</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../getting-started/quick-start/">Quick Start</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../getting-started/error-handling/">Error Handling</a>
        
    
    </li>
            
            
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        
            
            
            <span class="
        
    

    terminal-mkdocs-side-nav-item terminal-mkdocs-side-nav-section-no-index">Core Concepts</span>
        
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../core-concepts/overview/">Overview</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../core-concepts/nodes/">Nodes</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../core-concepts/workflows/">Workflows</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../core-concepts/actions/">Actions</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../core-concepts/contexts/">Contexts</a>
        
    
    </li>
            
            
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        
            
            
            <span class="
        
    

    terminal-mkdocs-side-nav-item terminal-mkdocs-side-nav-section-no-index">Guides</span>
        
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../guides/event_driven_architecture/">Event-Driven Architecture</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../guides/using-mermaid-diagrams/">Using Mermaid Diagrams</a>
        
    
    </li>
            
            
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        
            
            
            <span class="
        
    

    terminal-mkdocs-side-nav-item terminal-mkdocs-side-nav-section-no-index">Examples</span>
        
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../examples/basic-workflow/">Basic Workflow</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../examples/event-driven-workflow/">Event-Driven Workflow</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../examples/timer-node/">Timer Node</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../examples/reactive-node/">Reactive Node</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../examples/transform-node/">Transform Node</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../examples/longrunning-node/">Long-Running Node</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../examples/batch-processing/">Batch Processing</a>
        
    
    </li>
            
            
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        
            
            
            <span class="
        
    

    terminal-mkdocs-side-nav-item terminal-mkdocs-side-nav-section-no-index">Architecture</span>
        
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/adr-process/">ADR Process</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/core-framework-abstractions/">Core Framework Abstractions</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/project-structure/">Project Structure</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/async-runtime-selection/">Async Runtime Selection</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/node-lifecycle-methods/">Node Lifecycle Methods</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/event-driven-workflow-pattern/">Event-Driven Workflow Pattern</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/reactive-node-implementation/">Reactive Node Implementation</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/timer-node-implementation/">Timer Node Implementation</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/longrunning-node-implementation/">Long-Running Node Implementation</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/transform-node-implementation/">Transform Node Implementation</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../architecture/batch-processing-implementation/">Batch Processing Implementation</a>
        
    
    </li>
            
            
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        
            
            
            <span class="
        
    

    terminal-mkdocs-side-nav-item terminal-mkdocs-side-nav-section-no-index">API Reference</span>
        
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../api/floxide-core/">floxide-core</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../api/floxide-transform/">floxide-transform</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../api/floxide-event/">floxide-event</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../api/floxide-timer/">floxide-timer</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../api/floxide-reactive/">floxide-reactive</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../api/floxide-longrunning/">floxide-longrunning</a>
        
    
    </li>
            
        
            
            

             
                <li class="terminal-mkdocs-side-nav-li-ul-li">
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../api/floxide-batch/">floxide-batch</a>
        
    
    </li>
            
            
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../contributing/">Contributing</a>
        
    
    
    
  </li>
        
    </ul>
  
</nav><hr>
<nav>
    <ul>
        <li><a href="#adr-0028-version-bump-workflow-improvements">ADR-0028: Version Bump Workflow Improvements</a></li>
        <li><a href="#status">Status</a></li><li><a href="#date">Date</a></li><li><a href="#context">Context</a></li><li><a href="#decision">Decision</a></li><li><a href="#consequences">Consequences</a></li><li><a href="#alternatives-considered">Alternatives Considered</a></li>
    </ul>
</nav>
</aside>
            <main id="terminal-mkdocs-main-content">
<section id="mkdocs-terminal-content">
    <h1 id="adr-0028-version-bump-workflow-improvements">ADR-0028: Version Bump Workflow Improvements<a class="headerlink" href="#adr-0028-version-bump-workflow-improvements" title="Permanent link">&para;</a></h1>
<h2 id="status">Status<a class="headerlink" href="#status" title="Permanent link">&para;</a></h2>
<p>Proposed</p>
<h2 id="date">Date<a class="headerlink" href="#date" title="Permanent link">&para;</a></h2>
<p>2025-02-27</p>
<h2 id="context">Context<a class="headerlink" href="#context" title="Permanent link">&para;</a></h2>
<p>The Floxide framework uses GitHub Actions for CI/CD, including a workflow for version bumping that automates the process of updating version numbers across the workspace. This workflow uses <code>cargo-workspaces</code> to coordinate version changes and creates Git tags for releases.</p>
<p>We've encountered several issues with the version bump workflow:</p>
<ol>
<li><strong>Tag Conflict Error</strong>: The workflow fails with the error:</li>
</ol>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1">fatal: tag &#39;v1.0.0&#39; already exists
</span><span id="__span-0-2">Error: Process completed with exit code 128
</span></code></pre></div>
<p>This occurs because:
- The workflow attempts to create a tag that already exists in the repository
- The current implementation doesn't check for existing tags before attempting to create them
- The workflow creates both individual package tags (e.g., <code>floxide-core@1.0.0</code>) and a global version tag (e.g., <code>v1.0.0</code>)</p>
<ol>
<li><strong>Dependency Version Mismatch</strong>: When trying to update only some crates in the workspace, we encounter errors like:</li>
</ol>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1">error: failed to select a version for the requirement `floxide-core = &quot;=1.0.0&quot;`
</span><span id="__span-1-2">candidate versions found which didn&#39;t match: 1.0.1
</span></code></pre></div>
<p>This happens because:
- Some crates are updated while others remain at the previous version
- Crates have exact version dependencies on each other (using <code>=</code> in version requirements)
- This creates inconsistent dependency requirements that cannot be satisfied</p>
<ol>
<li><strong>Explicit Version Requirements Not Updated</strong>: The main <code>floxide</code> crate at the root has explicit version requirements for its dependencies:</li>
</ol>
<div class="language-toml highlight"><pre><span></span><code><span id="__span-2-1"><span class="n">floxide-core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;crates/floxide-core&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">optional</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>When the workspace version is updated, these explicit version requirements are not automatically updated by <code>cargo-workspaces</code>, causing dependency resolution errors.</p>
<p>Additionally, when the version bump workflow fails, it doesn't trigger the release workflow that publishes the crates to crates.io, breaking the automated release process.</p>
<h2 id="decision">Decision<a class="headerlink" href="#decision" title="Permanent link">&para;</a></h2>
<p>We will improve the version bump workflow to handle existing tags gracefully, ensure consistent versioning across all crates, update explicit version requirements, and ensure proper triggering of the release workflow by implementing the following changes:</p>
<ol>
<li>
<p><strong>Check for Existing Tags</strong>: Before attempting to create tags, check if they already exist.</p>
</li>
<li>
<p><strong>Force Option for Tags</strong>: Add an option to force-update existing tags when necessary.</p>
</li>
<li>
<p><strong>Skip Tag Creation Option</strong>: Add a workflow input parameter to optionally skip tag creation entirely.</p>
</li>
<li>
<p><strong>Trigger Release Option</strong>: Add an option to ensure the release workflow is triggered after a successful version bump.</p>
</li>
<li>
<p><strong>Handle Individual Crate Tags</strong>: When force-updating tags, also handle individual crate tags.</p>
</li>
<li>
<p><strong>Update All Crates Together</strong>: Use the <code>--all</code> flag with <code>cargo workspaces</code> to ensure all crates in the workspace are updated to the same version, maintaining consistent dependencies.</p>
</li>
<li>
<p><strong>Update Explicit Version Requirements</strong>: Add a step to update the explicit version requirements in the main Cargo.toml file.</p>
</li>
<li>
<p><strong>Improved Error Handling</strong>: Enhance error handling to provide clearer messages when tag-related issues occur.</p>
</li>
</ol>
<p>The implementation will involve updating the <code>.github/workflows/version-bump.yml</code> file to include these improvements.</p>
<h3 id="updated-workflow">Updated Workflow<a class="headerlink" href="#updated-workflow" title="Permanent link">&para;</a></h3>
<p>The updated workflow will include:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><span class="c1"># In the workflow_dispatch inputs section</span>
</span><span id="__span-3-2"><span class="nt">inputs</span><span class="p">:</span>
</span><span id="__span-3-3"><span class="w">  </span><span class="nt">bump_type</span><span class="p">:</span>
</span><span id="__span-3-4"><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Version</span><span class="nv"> </span><span class="s">bump</span><span class="nv"> </span><span class="s">type&quot;</span>
</span><span id="__span-3-5"><span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-3-6"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">choice</span>
</span><span id="__span-3-7"><span class="w">    </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-3-8"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">patch</span>
</span><span id="__span-3-9"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">minor</span>
</span><span id="__span-3-10"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">major</span>
</span><span id="__span-3-11"><span class="w">  </span><span class="nt">dry_run</span><span class="p">:</span>
</span><span id="__span-3-12"><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Dry</span><span class="nv"> </span><span class="s">run</span><span class="nv"> </span><span class="s">(no</span><span class="nv"> </span><span class="s">commits)&quot;</span>
</span><span id="__span-3-13"><span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-3-14"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span>
</span><span id="__span-3-15"><span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-3-16"><span class="w">  </span><span class="nt">force_tag</span><span class="p">:</span>
</span><span id="__span-3-17"><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Force</span><span class="nv"> </span><span class="s">update</span><span class="nv"> </span><span class="s">existing</span><span class="nv"> </span><span class="s">tags&quot;</span>
</span><span id="__span-3-18"><span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-3-19"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span>
</span><span id="__span-3-20"><span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-3-21"><span class="w">  </span><span class="nt">skip_tagging</span><span class="p">:</span>
</span><span id="__span-3-22"><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Skip</span><span class="nv"> </span><span class="s">tag</span><span class="nv"> </span><span class="s">creation</span><span class="nv"> </span><span class="s">entirely&quot;</span>
</span><span id="__span-3-23"><span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-3-24"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span>
</span><span id="__span-3-25"><span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-3-26"><span class="w">  </span><span class="nt">trigger_release</span><span class="p">:</span>
</span><span id="__span-3-27"><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Trigger</span><span class="nv"> </span><span class="s">release</span><span class="nv"> </span><span class="s">workflow</span><span class="nv"> </span><span class="s">after</span><span class="nv"> </span><span class="s">version</span><span class="nv"> </span><span class="s">bump&quot;</span>
</span><span id="__span-3-28"><span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-3-29"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">boolean</span>
</span><span id="__span-3-30"><span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span></code></pre></div>
<p>The version bump command will be updated to:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><span class="c1"># Use --no-git-tag to handle tagging manually and --all to update all packages</span>
</span><span id="__span-4-2"><span class="l l-Scalar l-Scalar-Plain">cargo workspaces version ${{ github.event.inputs.bump_type }} --exact --yes --no-git-tag --all</span>
</span></code></pre></div>
<p>And we'll add a step to update explicit version requirements:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><span class="c1"># Also update the explicit version requirements in the main Cargo.toml</span>
</span><span id="__span-5-2"><span class="c1"># This is needed because cargo-workspaces doesn&#39;t update these</span>
</span><span id="__span-5-3"><span class="l l-Scalar l-Scalar-Plain">sed -i &quot;s/floxide-core = { path = \&quot;crates\/floxide-core\&quot;, version = \&quot;[0-9.]*\&quot;/floxide-core = { path = \&quot;crates\/floxide-core\&quot;, version = \&quot;$NEW_VERSION\&quot;/g&quot; Cargo.toml</span>
</span><span id="__span-5-4"><span class="l l-Scalar l-Scalar-Plain">sed -i &quot;s/floxide-transform = { path = \&quot;crates\/floxide-transform\&quot;, version = \&quot;[0-9.]*\&quot;/floxide-transform = { path = \&quot;crates\/floxide-transform\&quot;, version = \&quot;$NEW_VERSION\&quot;/g&quot; Cargo.toml</span>
</span><span id="__span-5-5"><span class="l l-Scalar l-Scalar-Plain"># ... (similar lines for other crates)</span>
</span><span id="__span-5-6">
</span><span id="__span-5-7"><span class="l l-Scalar l-Scalar-Plain"># Commit the changes to the explicit version requirements</span>
</span><span id="__span-5-8"><span class="l l-Scalar l-Scalar-Plain">git add Cargo.toml</span>
</span><span id="__span-5-9"><span class="l l-Scalar l-Scalar-Plain">git commit --amend --no-edit</span>
</span><span id="__span-5-10"><span class="l l-Scalar l-Scalar-Plain">git push --force-with-lease origin HEAD</span>
</span></code></pre></div>
<p>The tag creation step will be updated to:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><span class="c1"># Create and push tag if not skipped</span>
</span><span id="__span-6-2"><span class="l l-Scalar l-Scalar-Plain">if [ &quot;${{ github.event.inputs.skip_tagging }}&quot; != &quot;true&quot; ]; then</span>
</span><span id="__span-6-3"><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">TAG_NAME=&quot;v${NEW_VERSION}&quot;</span>
</span><span id="__span-6-4"><span class="w">  </span>
</span><span id="__span-6-5"><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain"># Check if tag exists</span>
</span><span id="__span-6-6"><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">if git show-ref --tags &quot;$TAG_NAME&quot; --quiet; then</span>
</span><span id="__span-6-7"><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">if [ &quot;${{ github.event.inputs.force_tag }}&quot; = &quot;true&quot; ]; then</span>
</span><span id="__span-6-8"><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;Tag $TAG_NAME exists, force updating&quot;</span>
</span><span id="__span-6-9"><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">git tag -d &quot;$TAG_NAME&quot;</span>
</span><span id="__span-6-10"><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">git push origin &quot;:refs/tags/$TAG_NAME&quot; || true</span>
</span><span id="__span-6-11"><span class="w">      </span>
</span><span id="__span-6-12"><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain"># Also delete individual crate tags if they exist</span>
</span><span id="__span-6-13"><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">for CRATE_TAG in $(git tag | grep &quot;@${NEW_VERSION}$&quot;); do</span>
</span><span id="__span-6-14"><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;Deleting individual crate tag</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$CRATE_TAG&quot;</span>
</span><span id="__span-6-15"><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">git tag -d &quot;$CRATE_TAG&quot;</span>
</span><span id="__span-6-16"><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">git push origin &quot;:refs/tags/$CRATE_TAG&quot; || true</span>
</span><span id="__span-6-17"><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">done</span>
</span><span id="__span-6-18"><span class="w">      </span>
</span><span id="__span-6-19"><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain"># Create new tag</span>
</span><span id="__span-6-20"><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">git tag -a &quot;$TAG_NAME&quot; -m &quot;Release $TAG_NAME&quot;</span>
</span><span id="__span-6-21"><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">git push origin &quot;$TAG_NAME&quot;</span>
</span><span id="__span-6-22"><span class="w">      </span>
</span><span id="__span-6-23"><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;Tags updated successfully&quot;</span>
</span><span id="__span-6-24"><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">else</span>
</span><span id="__span-6-25"><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;Tag $TAG_NAME already exists. Use force_tag option to update it.&quot;</span>
</span><span id="__span-6-26"><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">exit 0</span>
</span><span id="__span-6-27"><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">fi</span>
</span><span id="__span-6-28"><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">else</span>
</span><span id="__span-6-29"><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">git tag -a &quot;$TAG_NAME&quot; -m &quot;Release $TAG_NAME&quot;</span>
</span><span id="__span-6-30"><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">git push origin &quot;$TAG_NAME&quot;</span>
</span><span id="__span-6-31"><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">fi</span>
</span><span id="__span-6-32"><span class="w">  </span>
</span><span id="__span-6-33"><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain"># If trigger_release is true, wait a moment for tag to be processed</span>
</span><span id="__span-6-34"><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain"># and then check if the tag was successfully pushed</span>
</span><span id="__span-6-35"><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">if [ &quot;${{ github.event.inputs.trigger_release }}&quot; = &quot;true&quot; ]; then</span>
</span><span id="__span-6-36"><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;Waiting for tag to be processed before triggering release workflow...&quot;</span>
</span><span id="__span-6-37"><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">sleep 10</span>
</span><span id="__span-6-38"><span class="w">    </span>
</span><span id="__span-6-39"><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain"># Check if the tag was successfully pushed</span>
</span><span id="__span-6-40"><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">if git ls-remote --tags origin | grep -q &quot;$TAG_NAME&quot;; then</span>
</span><span id="__span-6-41"><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;Tag $TAG_NAME successfully pushed, release workflow should be triggered automatically.&quot;</span>
</span><span id="__span-6-42"><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">else</span>
</span><span id="__span-6-43"><span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;Warning</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Tag $TAG_NAME not found on remote. Release workflow may not trigger.&quot;</span>
</span><span id="__span-6-44"><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">fi</span>
</span><span id="__span-6-45"><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">fi</span>
</span><span id="__span-6-46"><span class="l l-Scalar l-Scalar-Plain">else</span>
</span><span id="__span-6-47"><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;Skipping tag creation as requested&quot;</span>
</span><span id="__span-6-48"><span class="l l-Scalar l-Scalar-Plain">fi</span>
</span></code></pre></div>
<h2 id="consequences">Consequences<a class="headerlink" href="#consequences" title="Permanent link">&para;</a></h2>
<h3 id="positive">Positive<a class="headerlink" href="#positive" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Improved Reliability</strong>: The workflow will handle existing tags gracefully, reducing CI failures.</li>
<li><strong>More Flexibility</strong>: Users will have more control over tag creation and updates.</li>
<li><strong>Better Error Messages</strong>: Clearer feedback when tag-related issues occur.</li>
<li><strong>Safer Operations</strong>: Prevents accidental tag overwrites without explicit permission.</li>
<li><strong>Complete Release Process</strong>: Ensures the entire release pipeline from version bump to crates.io publishing works correctly.</li>
<li><strong>Comprehensive Tag Management</strong>: Handles both global and individual crate tags properly.</li>
<li><strong>Consistent Versioning</strong>: Ensures all crates in the workspace are updated together, preventing dependency version mismatches.</li>
<li><strong>Dependency Coherence</strong>: Updates explicit version requirements in the main Cargo.toml to match the new workspace version.</li>
</ol>
<h3 id="negative">Negative<a class="headerlink" href="#negative" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Increased Complexity</strong>: The workflow becomes slightly more complex with additional options.</li>
<li><strong>Potential for Confusion</strong>: More options may require better documentation for users.</li>
<li><strong>Less Granular Control</strong>: Using <code>--all</code> means individual crates cannot be versioned independently, which may be limiting in some scenarios.</li>
<li><strong>Brittle Version Updating</strong>: The sed commands for updating explicit version requirements are somewhat brittle and may need maintenance if the Cargo.toml structure changes.</li>
</ol>
<h2 id="alternatives-considered">Alternatives Considered<a class="headerlink" href="#alternatives-considered" title="Permanent link">&para;</a></h2>
<h3 id="manually-deleting-tags-before-running-the-workflow">Manually Deleting Tags Before Running the Workflow<a class="headerlink" href="#manually-deleting-tags-before-running-the-workflow" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Pros</strong>:</li>
<li>Simple approach</li>
<li>No workflow changes needed</li>
<li><strong>Cons</strong>:</li>
<li>Manual intervention required</li>
<li>Error-prone</li>
<li>Not scalable</li>
</ul>
<p>We rejected this approach as it doesn't provide a sustainable, automated solution.</p>
<h3 id="using-different-tag-naming-conventions">Using Different Tag Naming Conventions<a class="headerlink" href="#using-different-tag-naming-conventions" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Pros</strong>:</li>
<li>Could avoid conflicts by using unique names</li>
<li>Maintains history differently</li>
<li><strong>Cons</strong>:</li>
<li>Breaks existing conventions</li>
<li>May confuse users</li>
<li>Requires migration</li>
</ul>
<p>We chose to maintain the existing tag naming convention for consistency and compatibility.</p>
<h3 id="disabling-tagging-in-cargo-workspaces">Disabling Tagging in cargo-workspaces<a class="headerlink" href="#disabling-tagging-in-cargo-workspaces" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Pros</strong>:</li>
<li>Simpler workflow</li>
<li>More direct control</li>
<li><strong>Cons</strong>:</li>
<li>Loses some automation benefits</li>
<li>Requires manual tag management</li>
</ul>
<p>We chose a hybrid approach that leverages cargo-workspaces for version management but gives us more control over tag creation.</p>
<h3 id="separate-workflows-for-version-bump-and-release">Separate Workflows for Version Bump and Release<a class="headerlink" href="#separate-workflows-for-version-bump-and-release" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Pros</strong>:</li>
<li>Clearer separation of concerns</li>
<li>Potentially simpler workflows</li>
<li><strong>Cons</strong>:</li>
<li>More manual steps</li>
<li>Potential for inconsistency between version and release</li>
</ul>
<p>We chose to enhance the existing workflow structure to maintain the automated pipeline while adding more control options.</p>
<h3 id="independent-versioning-of-crates">Independent Versioning of Crates<a class="headerlink" href="#independent-versioning-of-crates" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Pros</strong>:</li>
<li>More granular control over individual crate versions</li>
<li>Allows for different release cycles per crate</li>
<li><strong>Cons</strong>:</li>
<li>Requires more complex dependency management</li>
<li>Prone to version mismatch errors</li>
<li>More difficult to maintain</li>
</ul>
<p>We chose to use the <code>--all</code> flag to ensure consistent versioning across all crates, which simplifies dependency management and reduces the chance of errors.</p>
<h3 id="using-cargo-workspace-inheritance-without-explicit-versions">Using Cargo Workspace Inheritance Without Explicit Versions<a class="headerlink" href="#using-cargo-workspace-inheritance-without-explicit-versions" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Pros</strong>:</li>
<li>Simpler dependency declarations</li>
<li>Automatic version synchronization</li>
<li><strong>Cons</strong>:</li>
<li>Less explicit about version requirements</li>
<li>May not work well with external consumers of the crates</li>
</ul>
<p>We chose to maintain explicit version requirements in the main Cargo.toml for clarity and compatibility with external consumers, while adding automation to keep these versions in sync. </p>
</section>

            </main>
        </div>
        <hr><footer>
    <div class="terminal-mkdocs-footer-grid">
        <div id="terminal-mkdocs-footer-copyright-info">
             Site built with <a href="http://www.mkdocs.org">MkDocs</a> and <a href="https://github.com/ntno/mkdocs-terminal">Terminal for MkDocs</a>.
        </div>
    </div>
</footer>
    </div>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="alertdialog" aria-modal="true" aria-labelledby="searchModalLabel">
    <div class="modal-dialog modal-lg" role="search">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="searchModalLabel">Search</h5>
                <button type="button" class="close btn btn-default btn-ghost" data-dismiss="modal"><span aria-hidden="true">x</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p id="searchInputLabel">Type to start searching</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" aria-labelledby="searchInputLabel" placeholder="" id="mkdocs-search-query" title="Please enter search terms here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No document matches found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    
    
</body>

</html>